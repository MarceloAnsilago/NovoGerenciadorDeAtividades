<div class="table-responsive">
  <table class="table table-hover align-middle mb-0">
    <thead class="table-light">
      <tr>
        <th><i class="bi bi-clipboard-check me-1"></i> Título</th>
        <th><i class="bi bi-diagram-3 me-1"></i> Área</th>
        <th class="text-center"><i class="bi bi-toggle-on me-1"></i> Status</th>
        <th class="text-end"><i class="bi bi-tools me-1"></i> Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for a in page_obj.object_list %}
        <tr>
          <td>
            <i class="bi bi-card-text text-primary me-2"></i> {{ a.titulo }}
          </td>
          <td>
            <i class="bi bi-diagram-3 me-1 text-muted"></i> {{ a.get_area_display }}
          </td>
          <td class="text-center">
            <span class="badge {% if a.ativo %}bg-success{% else %}bg-secondary{% endif %}">
              {% if a.ativo %}
                <i class="bi bi-check-lg me-1"></i> Ativa
              {% else %}
                <i class="bi bi-x-lg me-1"></i> Inativa
              {% endif %}
            </span>
          </td>
          <td class="text-end">
            <a href="{% url 'atividades:editar' a.id %}?next={{ request.get_full_path }}"
               class="btn btn-sm btn-warning me-1" title="Editar {{ a.titulo }}">
              <i class="bi bi-pencil"></i> Editar
            </a>

            <form method="post"
                  action="{% url 'atividades:toggle_ativo' a.id %}"
                  class="d-inline atividade-action-form"
                  onsubmit="return confirm('{% if a.ativo %}Inativar{% else %}Ativar{% endif %} esta atividade?');">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.get_full_path }}">
              <button type="submit"
                      class="btn btn-sm {% if a.ativo %}btn-outline-danger{% else %}btn-outline-success{% endif %}">
                <i class="bi {% if a.ativo %}bi-x-circle{% else %}bi-check-circle{% endif %} me-1"></i>
                {% if a.ativo %}Inativar{% else %}Ativar{% endif %}
              </button>
            </form>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4" class="text-center text-muted py-4">
            Nenhuma atividade encontrada.
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.atividade-action-form').forEach(form => {
      form.addEventListener('submit', function () {
        const btn = form.querySelector('button[type="submit"]');
        const icon = btn.querySelector('i');
        if (btn && icon) {
          btn.disabled = true;
          icon.classList.remove('bi-x-circle', 'bi-check-circle');
          icon.classList.add('spinner-border', 'spinner-border-sm', 'me-1');
        }
      }, { once: true });
    });
  });
</script>
