<form method="post" novalidate>
  {% csrf_token %}
  {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

  {% if conflict_assignments %}
    <div class="alert alert-warning">
      <h6 class="fw-semibold mb-2">
        <i class="bi bi-exclamation-triangle me-1"></i> Conflito com atividades
      </h6>
      <p class="mb-2">
        O servidor esta vinculado a atividades no periodo selecionado. Confirme a remocao para continuar.
      </p>
      <ul class="mb-0 ps-3 small">
        {% for c in conflict_assignments %}
          <li>
            <strong>{{ c.data|date:"d/m/Y" }}</strong> — {{ c.meta }}
            {% if c.observacao %}<span class="text-muted">({{ c.observacao }})</span>{% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <div class="mb-3">
    <label class="form-label">Servidor</label>
    {{ form.servidor }}
    {% if form.servidor.errors %}<div class="text-danger small">{{ form.servidor.errors }}</div>{% endif %}
  </div>

  <div class="mb-3">
    <label class="form-label">Tipo</label>
    {{ form.tipo }}
    {% if form.tipo.errors %}<div class="text-danger small">{{ form.tipo.errors }}</div>{% endif %}
  </div>

  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label">Data inicial</label>
      {{ form.data_inicio }}
      {% if form.data_inicio.errors %}<div class="text-danger small">{{ form.data_inicio.errors }}</div>{% endif %}
    </div>
    <div class="col-md-6 mb-3">
      <label class="form-label">Data final</label>
      {{ form.data_fim }}
      {% if form.data_fim.errors %}<div class="text-danger small">{{ form.data_fim.errors }}</div>{% endif %}
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Observações</label>
    {{ form.observacoes }}
    {% if form.observacoes.errors %}<div class="text-danger small">{{ form.observacoes.errors }}</div>{% endif %}
  </div>

  <div class="d-flex gap-2">
    {% if conflict_assignments %}
      <button type="submit" name="confirm_remove_assignments" value="1" class="btn btn-danger">
        <i class="bi bi-exclamation-triangle me-1"></i> Remover e salvar
      </button>
    {% else %}
      <button type="submit" class="btn btn-primary">
        <i class="bi bi-check2 me-1"></i> Salvar
      </button>
    {% endif %}
    {% if next %}
      <a href="{{ next }}" class="btn btn-secondary">Cancelar</a>
    {% else %}
      <a href="{% url 'descanso:lista_servidores' %}" class="btn btn-secondary">Cancelar</a>
    {% endif %}
  </div>
</form>
