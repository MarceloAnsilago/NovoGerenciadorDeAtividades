{% extends "core/base.html" %}
{% load perm_utils %}

{% block title %}Permissões de {{ usuario.username }}{% endblock %}

{% block content %}
<h1>Permissões de {{ usuario.username }}</h1>

<form method="post">
  {% csrf_token %}
  
  <div class="row">
    {% regroup form.fields.permissoes.queryset by content_type.app_label as app_list %}

    {% for app in app_list %}
      <div class="col-md-4 mb-4">
        <h5>{{ app.grouper|lower|lookup:app_labels }}</h5>

        {% for perm in app.list %}
          <div class="form-check mb-1">
            <input class="form-check-input"
                   type="checkbox"
                   name="permissoes"
                   value="{{ perm.id }}"
                   id="perm_{{ perm.id }}"
                   {% if perm in form.initial.permissoes %}checked{% endif %}>
            <label class="form-check-label" for="perm_{{ perm.id }}">
              {{ perm.name|perm_label }}
              <span class="text-muted small">
                ({{ perm.content_type.model|lower|lookup:model_labels }})
              </span>
            </label>
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <button type="submit" class="btn btn-success mt-3">Salvar permissões</button>
</form>
{% endblock %}
