{# templates/programar_atividades/print_programacao.html #}
{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Imprimir Programação — {{ plantao.inicio|default_if_none:"" }} → {{ plantao.fim|default_if_none:"" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  {# opcional: seu bootstrap local (ou remova/alterar para CDN) #}
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">

  <style>
    /* Reset / base */
    html, body { height: 100%; background: #fff; color: #111; }
    body {
      font-family: -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      margin: 10mm;
      font-size: 12px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    header.print-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 12px;
    }

    .logo {
      width: 72px;
      height: 72px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      background: #f5f7fb;
      border: 1px solid #e9eef8;
      font-weight: 700;
      color: #0d6efd;
    }

    header .title {
      flex: 1;
    }
    header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
    }
    .meta {
      color: #666;
      font-size: 12px;
    }

    /* Plantonistas - legenda */
    .plantonistas {
      margin: 10px 0 18px;
      padding: 10px 12px;
      border-radius: 6px;
      background: #fafbfd;
      border: 1px solid #eef3ff;
    }
    .plantonistas h6 { margin: 0 0 8px; font-size: 13px; }
    .plantonistas ul { margin: 0; padding-left: 1.1rem; }

    /* Tabela por grupo/semana */
    .grupo {
      margin-bottom: 18px;
      page-break-inside: avoid;
    }
    .grupo-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    .periodo {
      font-weight: 600;
      color: #111;
    }
    table.print-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 12px;
    }
    table.print-table thead th {
      text-align: left;
      padding: 8px;
      background: #f5f7fa;
      border: 1px solid #e9eef8;
      font-weight: 700;
    }
    table.print-table tbody td {
      padding: 8px;
      border: 1px solid #eef2f7;
      vertical-align: top;
    }
    .telefone { color: #444; white-space: nowrap; }

    /* Colunas pequenas */
    .col-small { width: 90px; text-align: center; }

    /* checkbox visual grande para impressão (non-interactive) */
    .check-box {
      display:inline-block;
      width:16px;
      height:16px;
      border:1px solid #333;
      vertical-align: middle;
      margin-right:6px;
    }

    /* Observação */
    .obs { color:#666; font-size:11px; margin-top:6px; }

    footer.print-footer {
      margin-top:18px;
      color:#666;
      font-size:11px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    /* Forçar que cada grupo não quebre no meio (só se possível) */
    @media print {
      body { margin: 6mm; }
      .no-print { display: none !important; }
      .page-break { page-break-after: always; }
      .plantonistas { page-break-inside: avoid; }
      .grupo { page-break-inside: avoid; }
      thead { display: table-header-group }
      tfoot { display: table-footer-group }
    }

    /* pequenas melhorias de legibilidade na tela */
    @media screen {
      .check-box { border-color:#bbb; }
    }
  </style>
</head>
<body>

  <header class="print-header">
    <div class="logo" aria-hidden="true">
      {# Substitua por <img src="{% static 'img/logo.png' %}"> se tiver logo #}
      LOGO
    </div>
    <div class="title">
      <h1>Programa de Atividades</h1>
      <div class="meta">
        {% if plantao.inicio and plantao.fim %}
          Período: {{ plantao.inicio|date:"d/m/Y" }} → {{ plantao.fim|date:"d/m/Y" }}
        {% else %}
          Período: —
        {% endif %}
        &nbsp;·&nbsp; Unidade: {{ request.user|default_if_none:"" }}
      </div>
    </div>
    <div style="text-align:right;">
      <div style="font-size:11px;color:#666;">Gerado por</div>
      <div style="font-weight:600;">{{ request.user.get_full_name|default:request.user.username }}</div>
    </div>
  </header>

  {# Plantonistas agregados da semana (se houver) - se você não quiser mostrar, remova este bloco #}
  {% if plantonistas_semana %}
    <section class="plantonistas" aria-label="Plantonistas da semana">
      <h6>Plantonista(s) da semana</h6>
      <ul>
        {% for p in plantonistas_semana %}
          <li>{{ p.nome }}{% if p.telefone %} — <span class="telefone">({{ p.telefone }})</span>{% endif %}</li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}

  {# Observação sobre marcação de presença (apenas informativo) #}
  <div class="obs">
    Observação: marque a caixa ao lado para indicar participação / atividade realizada.
  </div>

  {# Lista de grupos (semanas Sábado→Sexta) #}
  <main>
    {% if grupos %}
      {% for g in grupos %}
        <section class="grupo" aria-labelledby="periodo-{{ forloop.counter }}">
          <div class="grupo-header">
            <div id="periodo-{{ forloop.counter }}" class="periodo">
              {{ g.periodo.0|date:"d/m/Y" }} → {{ g.periodo.1|date:"d/m/Y" }}
            </div>
          </div>

          <table class="print-table" role="table" aria-describedby="periodo-{{ forloop.counter }}">
            <thead>
              <tr>
                <th style="width:4rem">#</th>
                <th style="width:50%">Servidores</th>
                <th style="width:24%">Telefone</th>
                <th class="col-small">Presença</th>
              </tr>
            </thead>
            <tbody>
              {% if g.servidores %}
                {% for s in g.servidores %}
                  <tr>
                    <td style="text-align:center">{{ forloop.counter }}</td>
                    <td>{{ s.nome }}</td>
                    <td class="telefone">{% if s.telefone %}{{ s.telefone }}{% else %}&mdash;{% endif %}</td>
                    <td class="col-small" style="text-align:center">
                      <span class="check-box" aria-hidden="true"></span>
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="4" style="text-align:left; color:#666;">Nenhum servidor atribuído nesta semana.</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </section>
      {% endfor %}
    {% else %}
      <div style="margin-top:12px;color:#666;">Nenhuma programação encontrada para o período selecionado.</div>
    {% endif %}
  </main>

  <footer class="print-footer">
    <div>Gerado por: <strong>{{ request.user.get_full_name|default:request.user.username }}</strong></div>
    <div>Data: {{ now|date:"d/m/Y H:i" }}</div>
  </footer>

  <script>
    // dispara print automaticamente quando a página carregar em nova aba
    // (mantemos um pequeno delay para garantir que fontes/estilos sejam aplicados)
    window.addEventListener('load', function() {
      try {
        setTimeout(function() { window.print(); }, 200);
      } catch (e) { /* noop */ }
    });
  </script>
</body>
</html>
