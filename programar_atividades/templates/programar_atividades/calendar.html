{% extends "core/base.html" %}
{% load static %}

{% block extra_head %}
  <!-- FullCalendar + Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    #calendar {
      max-width: 1100px;
      margin: 24px auto;
      min-height: 520px;
      background: #fff;
      padding: 8px;
    }
  </style>
{% endblock %}

{% block content %}
  <div class="container my-4">
    <h1>Programar Atividades</h1>
    <div id="calendar" class="mt-4"></div>
  </div>

  <!-- ✅ Modal de Nova Atividade -->
  <div class="modal fade" id="modalAtividade" tabindex="-1" aria-labelledby="modalAtividadeLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalAtividadeLabel">Nova Atividade</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <form id="formAtividade">
            <div class="mb-3">
              <label for="dataAtividade" class="form-label">Data</label>
              <input type="text" class="form-control" id="dataAtividade" name="data" readonly>
            </div>
            <div class="mb-3">
              <label for="descricaoAtividade" class="form-label">Descrição</label>
              <input type="text" class="form-control" id="descricaoAtividade" name="descricao" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" form="formAtividade" class="btn btn-primary">Salvar</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  <!-- Bootstrap + FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales-all.global.min.js"></script>

  <!-- URL de eventos para o calendário -->
  <script>
    window.calendarFeedURL = "{% url 'programar_atividades:events_feed' %}";
  </script>

  <!-- Lógica do calendário e modal -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('calendar');
      const dataInput = document.getElementById('dataAtividade');
      const modalEl = document.getElementById('modalAtividade');
      const modal = new bootstrap.Modal(modalEl);

      const calendar = new FullCalendar.Calendar(calendarEl, {
        locale: 'pt-br',
        initialView: 'dayGridMonth',
        firstDay: 1,
        timeZone: 'local',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: ''
        },
        buttonText: {
          today: 'Hoje',
          month: 'Mês',
          week: 'Semana',
          day: 'Dia'
        },
        height: 'auto',
        events: window.calendarFeedURL,
        dateClick: function (info) {
          dataInput.value = info.dateStr;
          modal.show();
        }
      });

      calendar.render();
    });
  </script>
{% endblock %}
