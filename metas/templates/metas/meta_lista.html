{% extends "core/base.html" %}
{% load static %}

{% block title %}Metas da Unidade{% endblock %}

{% block content %}
{% if request.GET.atividade %}
  {% with alocacoes.0.meta.atividade as atividade_atual %}
    <p class="text-muted">Filtrado por atividade: <strong>{{ atividade_atual.nome }}</strong></p>
  {% endwith %}
{% endif %}
<div class="container py-4">
  {% url 'core:dashboard' as dash_url %}
  {% include "partials/_page_header.html" with title="Metas" subtitle="Unidade atual: "|add:unidade.nome back_url=dash_url icon="bi-bullseye" %}
 
  <div class="card shadow-sm">
    <div class="card-header bg-light">
      <strong><i class="bi bi-bullseye me-1"></i> Metas Alocadas</strong>
    </div>
    <div class="card-body">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Título</th>
            <th>Atividade</th>
            <th>Prazo</th>
            <th>Alocação</th>
            <th>Realizado</th>
            <th>% Execução</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for aloc in alocacoes %}
          <tr>
            <td>{{ aloc.meta.titulo }}</td>
            <td>
            {% if aloc.meta.atividade %}
                {{ aloc.meta.atividade.nome }}
            {% else %}
                <span class="text-muted">—</span>
            {% endif %}
            </td>
            <td>{{ aloc.meta.data_limite|date:"d/m/Y" }}</td>
            <td>{{ aloc.quantidade_alocada }}</td>
            <td>{{ aloc.realizado }}</td>
            <td>{{ aloc.percentual_execucao|floatformat:1 }}%</td>
            <td>
              {% if aloc.meta.concluida %}
                <span class="badge bg-success">Concluída</span>
              {% elif aloc.meta.atrasada %}
                <span class="badge bg-danger">Atrasada</span>
              {% else %}
                <span class="badge bg-warning text-dark">Em andamento</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="7" class="text-center">Nenhuma meta alocada.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
