{% extends "core/base.html" %}

{% block title %}Mapa de Feriados - {{ ano }}{% endblock %}

{% block content %}
<div class="container mt-4 report-container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">
      <i class="bi bi-calendar3 me-2"></i> Mapa de Feriados - {{ ano }}
      {% if cadastro %}<small class="text-muted">({{ cadastro.descricao }})</small>{% endif %}
    </h2>

    <div class="report-toolbar d-flex gap-2">
      <form method="get" class="d-flex align-items-center gap-2">
        <input type="hidden" name="cadastro" value="{{ cadastro.id }}">
        <label class="form-label mb-0 small">Ano</label>
        <select name="ano" class="form-select form-select-sm">
          {% for a in anos_opcoes %}
            <option value="{{ a }}" {% if a == ano %}selected{% endif %}>{{ a }}</option>
          {% endfor %}
        </select>
        <button class="btn btn-sm btn-outline-primary" type="submit" title="Atualizar ano">
          <i class="bi bi-arrow-repeat me-1"></i> Atualizar
        </button>
      </form>

      <button class="btn btn-sm btn-outline-secondary" type="button" onclick="window.print()">
        <i class="bi bi-printer"></i> Imprimir
      </button>

      <a href="{% url 'descanso:lista_servidores' %}" class="btn btn-sm btn-secondary">
        <i class="bi bi-arrow-left"></i> Voltar
      </a>
    </div>
  </div>

  {% if not meses_data %}
    <div class="text-muted">Nenhum feriado cadastrado para este periodo.</div>
  {% endif %}

  {% for mes in meses_data %}
    <section class="month-block">
      <h4 class="mt-4">{{ mes.mes_nome }}</h4>
      <div class="table-responsive mb-2">
        <table class="table table-bordered table-sm text-center align-middle w-100" style="font-size:.95rem;">
          <thead class="table-secondary">
            <tr>
              <th>Feriados do mes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <div class="days-grid">
                  {% for dia in mes.dias %}
                    <span class="day-square {% if dia.marked %}day-marked{% elif dia.weekend %}day-weekend{% else %}day-empty{% endif %}" title="Dia {{ dia.num }}{% if dia.marked %} com feriado{% elif dia.weekend %} (fim de semana){% endif %}">
                      {{ dia.num }}
                    </span>
                  {% endfor %}
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="small text-muted mb-3">
        {% for item in mes.legenda %}
          <div>
            <strong>{{ item.data }}</strong> - {{ item.descricao }}
            {% if item.cadastro %}<span class="text-muted">({{ item.cadastro }})</span>{% endif %}
          </div>
        {% endfor %}
      </div>
    </section>
  {% endfor %}
</div>

<style>
.days-grid { display:flex; flex-wrap:wrap; gap:2px; }
.day-square {
  display:inline-flex;
  width:24px;
  height:24px;
  align-items:center;
  justify-content:center;
  font-size:.7rem;
  border-radius:4px;
  border:1px solid #dee2e6;
  background:#fff;
  color:#555;
}
.day-empty { background:#f8f9fa; }
.day-weekend { background:#e7f3ff; color:#2b4c7e; border-color:#9cc0ff; }
.day-marked { background:#222; color:#fff; border-color:#222; }

@media print {
  @page { margin: 10mm 10mm 14mm 10mm; }
  .navbar, .sidebar, .navbar-brand, .navbar-text { display:none !important; }
  .report-toolbar, .btn { display:none !important; }
  .content, .container, .container-fluid, .report-container {
    width:100% !important; max-width:none !important;
    margin:0 auto !important; padding:0 !important;
  }
  .wrapper, .layout, .content { margin:0 !important; }
  .table, .table-responsive { width:100% !important; }
  .month-block { break-inside: avoid; page-break-inside: avoid; margin-bottom:8mm; }
  h2, h4 { color:#000 !important; }
  .day-square { border-color:#000 !important; color:#000 !important; background:#fff !important; }
  .day-weekend {
    border-style: dashed !important;
    background-image: repeating-linear-gradient(45deg, #000 0, #000 1px, transparent 1px, transparent 3px) !important;
    background-size: 6px 6px !important;
  }
  .day-marked { background:#000 !important; color:#fff !important; }
}
</style>
{% endblock %}
