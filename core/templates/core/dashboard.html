{% extends "core/base.html" %}
{% load static %}

{% block title %}Dashboard Operacional{% endblock %}

{% block content %}
<div class="container-fluid py-3" id="dashboard-root">
  <div class="d-flex flex-wrap justify-content-between align-items-end gap-3 mb-4">
    <div>
      <h1 class="h3 mb-1">Dashboard Operacional</h1>
      <p class="text-muted mb-0">
        Monitoramento em tempo real das metas, atividades e recursos.
      </p>
    </div>
  </div>

  <div class="row g-3" data-kpis-container>
    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <p class="text-muted text-uppercase fw-semibold small mb-1">Metas ativas</p>
            <div class="display-6 fw-bold mb-0" data-kpi="metas_ativas">--</div>
          </div>
          <span class="rounded-circle bg-primary-subtle text-primary-emphasis d-inline-flex align-items-center justify-content-center"
            style="width: 3rem; height: 3rem;">
            <i class="bi bi-flag" aria-hidden="true"></i>
          </span>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <p class="text-muted text-uppercase fw-semibold small mb-1">% metas concluidas</p>
            <div class="display-6 fw-bold mb-0" data-kpi="percentual_metas_concluidas">--</div>
          </div>
          <span class="rounded-circle bg-success-subtle text-success-emphasis d-inline-flex align-items-center justify-content-center"
            style="width: 3rem; height: 3rem;">
            <i class="bi bi-graph-up-arrow" aria-hidden="true"></i>
          </span>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <p class="text-muted text-uppercase fw-semibold small mb-1">Atividades concluidas hoje</p>
            <div class="display-6 fw-bold mb-0" data-kpi="atividades_concluidas_hoje">--</div>
          </div>
          <span class="rounded-circle bg-info-subtle text-info-emphasis d-inline-flex align-items-center justify-content-center"
            style="width: 3rem; height: 3rem;">
            <i class="bi bi-check2-circle" aria-hidden="true"></i>
          </span>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <p class="text-muted text-uppercase fw-semibold small mb-1">Servidores ativos</p>
            <div class="display-6 fw-bold mb-0" data-kpi="servidores_ativos">--</div>
          </div>
          <span class="rounded-circle bg-warning-subtle text-warning-emphasis d-inline-flex align-items-center justify-content-center"
            style="width: 3rem; height: 3rem;">
            <i class="bi bi-people" aria-hidden="true"></i>
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mt-2">
    <div class="col-12 col-xl-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white fw-semibold d-flex justify-content-between align-items-center">
          <span>Metas por unidade</span>
        </div>
        <div class="card-body">
          <canvas id="chartMetasUnidade" data-endpoint="{% url 'core:dashboard_metas_por_unidade' %}" height="260"></canvas>
        </div>
      </div>
    </div>
    <div class="col-12 col-xl-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white fw-semibold d-flex justify-content-between align-items-center">
          <span>Atividades por area</span>
        </div>
        <div class="card-body">
          <canvas id="chartAtividadesArea" data-endpoint="{% url 'core:dashboard_atividades_por_area' %}" height="260"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mt-1">
    <div class="col-12 col-xl-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white fw-semibold">Progresso mensal (quantidade)</div>
        <div class="card-body">
          <canvas id="chartProgressoMensal" data-endpoint="{% url 'core:dashboard_progresso_mensal' %}" height="260"></canvas>
        </div>
      </div>
    </div>
    <div class="col-12 col-xl-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white fw-semibold">Programacoes concluidas vs pendentes</div>
        <div class="card-body">
          <canvas id="chartProgramacoesStatus" data-endpoint="{% url 'core:dashboard_programacoes_status_mensal' %}" height="260"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mt-1">
    <div class="col-12 col-xl-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white fw-semibold">Uso de veiculos em programacoes</div>
        <div class="card-body">
          <canvas id="chartUsoVeiculos" data-endpoint="{% url 'core:dashboard_uso_veiculos' %}" height="260"></canvas>
        </div>
      </div>
    </div>
    <div class="col-12 col-xl-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white fw-semibold">Top servidores em atividades</div>
        <div class="card-body">
          <canvas id="chartTopServidores" data-endpoint="{% url 'core:dashboard_top_servidores' %}" height="260"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mt-1">
    <div class="col-12">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white fw-semibold">Plantoes por semana</div>
        <div class="card-body">
          <canvas id="chartPlantaoSemanal" data-endpoint="{% url 'core:dashboard_plantao_heatmap' %}" height="260"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
  {{ block.super }}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    window.DashboardEndpoints = {
      kpis: "{% url 'core:dashboard_kpis' %}",
      metasPorUnidade: "{% url 'core:dashboard_metas_por_unidade' %}",
      atividadesPorArea: "{% url 'core:dashboard_atividades_por_area' %}",
      progressoMensal: "{% url 'core:dashboard_progresso_mensal' %}",
      programacoesStatus: "{% url 'core:dashboard_programacoes_status_mensal' %}",
      plantaoHeatmap: "{% url 'core:dashboard_plantao_heatmap' %}",
      usoVeiculos: "{% url 'core:dashboard_uso_veiculos' %}",
      topServidores: "{% url 'core:dashboard_top_servidores' %}",
    };
  </script>
  <script src="{% static 'core/js/dashboard.js' %}" defer></script>
{% endblock %}
