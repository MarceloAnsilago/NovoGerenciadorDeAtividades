<script>
(function(){
  const modalEl = document.getElementById('programar-modalAtividade');
  const inputData = document.getElementById('programar-dataAtividade');
  const btnSalvar = document.getElementById('programar-btnSalvar');

  window.PROGRAMAR = window.PROGRAMAR || {};
  window.PROGRAMAR.openProgramarModal = function(dateStr, labelText){
    if (!modalEl) return;

    /* ðŸ”§ anti-duplicaÃ§Ã£o: mantÃ©m sÃ³ a PRIMEIRA linha de cards, remove demais */
    const rows = modalEl.querySelectorAll('#programar-atividadesRow, .cards-row');
    if (rows.length > 1) rows.forEach((r, i) => { if (i > 0) r.remove(); });

    inputData.value = dateStr || '';
    const lbl = document.getElementById('programar-modalAtividadeLabel');
    if (lbl) lbl.textContent = labelText ? `Programar atividades â€” ${labelText}` : 'Programar atividades';
    bootstrap.Modal.getOrCreateInstance(modalEl).show();
    btnSalvar.disabled = true;

    window.PROGRAMAR.loadMetas?.(dateStr);
    window.PROGRAMAR.loadServidores?.(dateStr);
  };
})();
</script>
